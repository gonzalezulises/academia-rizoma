# Ejercicio 10: Caso Integrador - Aseguradora del PacÃ­fico
# Tipo: code-python (cÃ³digo oculto)

id: ex-10-caso-aseguradora
type: code-python
title: "Caso: Aseguradora del PacÃ­fico"
description: "Aplica todo lo aprendido en un caso integrador realista."

instructions: |
  **Contexto del Caso:**
  Aseguradora del PacÃ­fico (450 empleados en 3 paÃ­ses) ha experimentado:
  - Tiempo de aprobaciÃ³n de pÃ³lizas: 12 dÃ­as (benchmark: 5 dÃ­as)
  - Quejas de clientes: +40% en 6 meses
  - RotaciÃ³n en Claims: 25% anual

  El CEO te contratÃ³ para hacer un diagnÃ³stico ONA del Ã¡rea de Claims.

  **Datos disponibles:**
  - Red de consultas del Ã¡rea de Claims (25 personas)
  - Departamentos: RecepciÃ³n, AnÃ¡lisis, AprobaciÃ³n, AtenciÃ³n al Cliente

  **Tu tarea:**
  Analiza los datos y prepara un diagnÃ³stico ejecutivo con:
  1. Problema principal identificado
  2. MÃ©tricas que lo evidencian
  3. RecomendaciÃ³n prioritaria

difficulty: advanced
estimated_time_minutes: 15
points: 50
order: 10

required_packages:
  - networkx
  - matplotlib
  - pandas
  - numpy

ui_config:
  hide_code: true
  show_output_only: true
  interactive_mode: visualization

datasets:
  - id: aseguradora
    path: shared/datasets/aseguradora.csv
    name: "Aseguradora del PacÃ­fico"
    description: "Datos de ONA del Ã¡rea de Claims"

starter_code: |
  import networkx as nx
  import matplotlib.pyplot as plt
  import pandas as pd
  import numpy as np

  # Crear red de Claims de Aseguradora del PacÃ­fico
  G = nx.Graph()

  # Estructura del Ã¡rea de Claims
  empleados = {
      # RecepciÃ³n (entrada de casos)
      'R1': 'RecepciÃ³n', 'R2': 'RecepciÃ³n', 'R3': 'RecepciÃ³n',
      'R4': 'RecepciÃ³n', 'R5': 'RecepciÃ³n',
      # AnÃ¡lisis (evaluaciÃ³n tÃ©cnica)
      'A1': 'AnÃ¡lisis', 'A2': 'AnÃ¡lisis', 'A3': 'AnÃ¡lisis',
      'A4': 'AnÃ¡lisis', 'A5': 'AnÃ¡lisis', 'A6': 'AnÃ¡lisis',
      # AprobaciÃ³n (autorizaciÃ³n de pagos)
      'AP1': 'AprobaciÃ³n', 'AP2': 'AprobaciÃ³n', 'AP3': 'AprobaciÃ³n',
      # AtenciÃ³n al Cliente
      'AC1': 'AtenciÃ³n', 'AC2': 'AtenciÃ³n', 'AC3': 'AtenciÃ³n',
      'AC4': 'AtenciÃ³n', 'AC5': 'AtenciÃ³n',
      # Supervisores
      'Sup_Rec': 'SupervisiÃ³n',
      'Sup_Ana': 'SupervisiÃ³n',
      'Sup_Apr': 'SupervisiÃ³n',
      # Gerente
      'Gerente': 'Gerencia',
  }

  for emp, dept in empleados.items():
      G.add_node(emp, departamento=dept)

  # Conexiones que revelan el problema
  edges = [
      # RecepciÃ³n - bien conectada internamente
      ('R1', 'R2'), ('R2', 'R3'), ('R3', 'R4'), ('R4', 'R5'),
      ('R1', 'R3'), ('R2', 'R4'),
      ('R1', 'Sup_Rec'), ('R3', 'Sup_Rec'), ('R5', 'Sup_Rec'),

      # AnÃ¡lisis - conectado internamente
      ('A1', 'A2'), ('A2', 'A3'), ('A3', 'A4'), ('A4', 'A5'), ('A5', 'A6'),
      ('A1', 'A3'), ('A2', 'A4'), ('A3', 'A5'),
      ('A1', 'Sup_Ana'), ('A4', 'Sup_Ana'), ('A6', 'Sup_Ana'),

      # AprobaciÃ³n - pequeÃ±o equipo, bien conectado
      ('AP1', 'AP2'), ('AP2', 'AP3'), ('AP1', 'AP3'),
      ('AP1', 'Sup_Apr'), ('AP2', 'Sup_Apr'),

      # AtenciÃ³n al Cliente - conectado internamente
      ('AC1', 'AC2'), ('AC2', 'AC3'), ('AC3', 'AC4'), ('AC4', 'AC5'),
      ('AC1', 'AC3'), ('AC2', 'AC4'),

      # Supervisores con Gerente
      ('Sup_Rec', 'Gerente'), ('Sup_Ana', 'Gerente'), ('Sup_Apr', 'Gerente'),

      # PROBLEMA: Conexiones entre Ã¡reas (MUY POCAS!)
      # RecepciÃ³n â†’ AnÃ¡lisis: SOLO a travÃ©s de Sup_Ana (cuello de botella)
      ('Sup_Rec', 'Sup_Ana'),

      # AnÃ¡lisis â†’ AprobaciÃ³n: SOLO AP1 recibe casos
      ('Sup_Ana', 'AP1'),

      # AprobaciÃ³n â†’ AtenciÃ³n: NINGUNA conexiÃ³n directa (SILO!)
      # Los casos "se pierden" entre AprobaciÃ³n y AtenciÃ³n

      # AtenciÃ³n no tiene feedback con nadie
      # Solo AC1 habla con el Gerente para escalar
      ('AC1', 'Gerente'),
  ]

  G.add_edges_from(edges)

  # Calcular mÃ©tricas
  betweenness = nx.betweenness_centrality(G)
  degree = dict(G.degree())
  closeness = nx.closeness_centrality(G)

  # Crear DataFrame de mÃ©tricas
  df_metricas = pd.DataFrame({
      'Empleado': list(empleados.keys()),
      'Departamento': list(empleados.values()),
      'Grado': [degree[e] for e in empleados.keys()],
      'IntermediaciÃ³n': [round(betweenness[e], 3) for e in empleados.keys()],
      'CercanÃ­a': [round(closeness[e], 3) for e in empleados.keys()]
  })

  # VisualizaciÃ³n completa
  fig = plt.figure(figsize=(18, 12))

  # 1. Red general
  ax1 = fig.add_subplot(2, 2, 1)
  colores_dept = {
      'RecepciÃ³n': '#3498db',
      'AnÃ¡lisis': '#2ecc71',
      'AprobaciÃ³n': '#e74c3c',
      'AtenciÃ³n': '#9b59b6',
      'SupervisiÃ³n': '#f1c40f',
      'Gerencia': '#e67e22'
  }
  node_colors = [colores_dept[G.nodes[n]['departamento']] for n in G.nodes()]
  node_sizes = [800 + betweenness[n] * 3000 for n in G.nodes()]

  pos = nx.spring_layout(G, k=2.5, seed=42)
  nx.draw(G, pos, ax=ax1, with_labels=True, node_color=node_colors,
          node_size=node_sizes, font_size=8, font_weight='bold', edge_color='gray')
  ax1.set_title("Red de Claims - Aseguradora del PacÃ­fico\n(TamaÃ±o = IntermediaciÃ³n)",
                fontsize=11, fontweight='bold')

  # 2. Matriz de conexiones entre departamentos
  ax2 = fig.add_subplot(2, 2, 2)
  dept_names = ['RecepciÃ³n', 'AnÃ¡lisis', 'AprobaciÃ³n', 'AtenciÃ³n', 'SupervisiÃ³n']
  matriz = pd.DataFrame(0, index=dept_names, columns=dept_names)

  for edge in G.edges():
      n1, n2 = edge
      d1 = G.nodes[n1]['departamento']
      d2 = G.nodes[n2]['departamento']
      if d1 != d2 and d1 in dept_names and d2 in dept_names:
          matriz.loc[d1, d2] += 1
          matriz.loc[d2, d1] += 1

  im = ax2.imshow(matriz.values, cmap='RdYlGn')
  ax2.set_xticks(range(len(dept_names)))
  ax2.set_yticks(range(len(dept_names)))
  ax2.set_xticklabels(dept_names, rotation=45, ha='right', fontsize=9)
  ax2.set_yticklabels(dept_names, fontsize=9)

  for i in range(len(dept_names)):
      for j in range(len(dept_names)):
          val = matriz.iloc[i, j]
          color = 'white' if val < 1 else 'black'
          ax2.text(j, i, str(int(val)), ha='center', va='center', color=color, fontsize=11)

  ax2.set_title("Conexiones Entre Departamentos\n(0 = SILO)", fontsize=11, fontweight='bold')

  # 3. Top cuellos de botella
  ax3 = fig.add_subplot(2, 2, 3)
  top_bottleneck = df_metricas.nlargest(8, 'IntermediaciÃ³n')[['Empleado', 'Departamento', 'IntermediaciÃ³n']]

  colors = ['#e74c3c' if x > 0.15 else '#f1c40f' if x > 0.08 else '#2ecc71'
            for x in top_bottleneck['IntermediaciÃ³n']]
  bars = ax3.barh(top_bottleneck['Empleado'], top_bottleneck['IntermediaciÃ³n'], color=colors)
  ax3.set_xlabel('IntermediaciÃ³n (Betweenness)')
  ax3.set_title('Top Cuellos de Botella', fontsize=11, fontweight='bold')
  ax3.invert_yaxis()

  # 4. DiagnÃ³stico ejecutivo
  ax4 = fig.add_subplot(2, 2, 4)
  ax4.axis('off')

  diagnostico = """
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘           DIAGNÃ“STICO EJECUTIVO - CLAIMS                 â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘                                                          â•‘
  â•‘  ğŸ”´ PROBLEMA PRINCIPAL:                                  â•‘
  â•‘     Silos entre AprobaciÃ³n y AtenciÃ³n al Cliente         â•‘
  â•‘     (0 conexiones directas)                              â•‘
  â•‘                                                          â•‘
  â•‘  ğŸ“Š EVIDENCIA:                                           â•‘
  â•‘     â€¢ Sup_Ana: IntermediaciÃ³n 0.35 (cuello crÃ­tico)      â•‘
  â•‘     â€¢ AP1: Ãšnico punto de entrada a AprobaciÃ³n           â•‘
  â•‘     â€¢ AtenciÃ³n aislada del flujo operativo               â•‘
  â•‘                                                          â•‘
  â•‘  ğŸ’¡ IMPACTO EN NEGOCIO:                                  â•‘
  â•‘     â€¢ Casos se "pierden" entre AprobaciÃ³n y AtenciÃ³n     â•‘
  â•‘     â€¢ Clientes no reciben updates de estado              â•‘
  â•‘     â€¢ AtenciÃ³n escala al Gerente (no resuelve)           â•‘
  â•‘                                                          â•‘
  â•‘  âœ… RECOMENDACIÃ“N PRIORITARIA:                           â•‘
  â•‘     Crear conexiÃ³n directa AprobaciÃ³n â†’ AtenciÃ³n         â•‘
  â•‘     (asignar AP2 como enlace con AC2)                    â•‘
  â•‘                                                          â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  """
  ax4.text(0.5, 0.5, diagnostico, transform=ax4.transAxes,
           fontsize=9, family='monospace', va='center', ha='center',
           bbox=dict(boxstyle='round', facecolor='#f8f9fa', edgecolor='#dee2e6'))

  # Leyenda global
  legend_elements = [
      plt.Line2D([0], [0], marker='o', color='w', markerfacecolor=c, markersize=10, label=d)
      for d, c in colores_dept.items()
  ]
  fig.legend(handles=legend_elements, loc='lower center', ncol=6, fontsize=9)

  plt.tight_layout()
  plt.subplots_adjust(bottom=0.08)
  plt.show()

  # Resumen de hallazgos
  print("\n" + "="*70)
  print("CASO: ASEGURADORA DEL PACÃFICO - RESUMEN DE HALLAZGOS")
  print("="*70)

  print("\nğŸ” ANÃLISIS COMPLETADO:")
  print(f"   â€¢ Total empleados analizados: {len(empleados)}")
  print(f"   â€¢ Total conexiones: {G.number_of_edges()}")
  print(f"   â€¢ Densidad de red: {nx.density(G):.3f}")

  print("\nğŸš¨ HALLAZGOS CRÃTICOS:")
  print("   1. SILO: AprobaciÃ³n â†” AtenciÃ³n = 0 conexiones")
  print("   2. CUELLO: Sup_Ana procesa 100% de casos RecepciÃ³nâ†’AnÃ¡lisis")
  print("   3. CUELLO: AP1 es Ãºnico punto de entrada a AprobaciÃ³n")
  print("   4. AISLAMIENTO: AtenciÃ³n no tiene visibilidad del flujo")

  print("\n" + "="*70)
  print("PREGUNTA FINAL")
  print("="*70)
  print("\nÂ¿CuÃ¡l de estas intervenciones tendrÃ­a MAYOR impacto en reducir")
  print("el tiempo de aprobaciÃ³n de pÃ³lizas?")
  print("\nOpciones:")
  print("A) Contratar mÃ¡s personal en AtenciÃ³n al Cliente")
  print("B) Crear conexiÃ³n directa entre AprobaciÃ³n y AtenciÃ³n")
  print("C) Capacitar al Gerente en gestiÃ³n de equipos")
  print("D) Implementar un software de tracking de casos")

solution_code: |
  # Respuesta correcta: B) Crear conexiÃ³n directa AprobaciÃ³n â†’ AtenciÃ³n
  #
  # JustificaciÃ³n basada en datos ONA:
  #
  # 1. El SILO entre AprobaciÃ³n y AtenciÃ³n causa:
  #    - Casos "perdidos" despuÃ©s de aprobaciÃ³n
  #    - Clientes sin informaciÃ³n de estado
  #    - Escalamientos innecesarios al Gerente
  #
  # 2. Por quÃ© las otras opciones NO resuelven:
  #    - A) MÃ¡s personal en AtenciÃ³n no sirve si no reciben los casos
  #    - C) Capacitar al Gerente no arregla la estructura de red
  #    - D) Software solo automatiza un proceso roto
  #
  # 3. ImplementaciÃ³n recomendada:
  #    - Asignar AP2 como enlace formal con AC2
  #    - ReuniÃ³n diaria de 15 min AprobaciÃ³n-AtenciÃ³n
  #    - Tablero compartido de casos en proceso
  #    - Re-medir ONA en 3 meses
  #
  # Impacto esperado:
  #    - ReducciÃ³n tiempo: 12 dÃ­as â†’ 7 dÃ­as (primer mes)
  #    - ReducciÃ³n quejas: -30% (visibilidad para clientes)
  #    - Mejora rotaciÃ³n: mejor flujo = menos frustraciÃ³n

test_cases:
  - id: test-case-analysis
    name: "Caso integrador completado"
    test_code: |
      assert True, "AnÃ¡lisis del caso ejecutado correctamente"
    points: 50

hints:
  - "Busca dÃ³nde hay 0 conexiones entre departamentos"
  - "Los cuellos de botella (alta intermediaciÃ³n) indican dependencias"
  - "La soluciÃ³n debe atacar la causa raÃ­z, no los sÃ­ntomas"

tags:
  - ona
  - caso-integrador
  - silos
  - diagnostico

concepts:
  - diagnostico-ejecutivo
  - silos
  - cuello-de-botella
  - recomendaciones

# Preguntas interactivas mostradas despuÃ©s de la visualizaciÃ³n
comprehension_questions:
  - id: cq-01-problema-principal
    question: "Â¿CuÃ¡l es el problema PRINCIPAL identificado en el Ã¡rea de Claims?"
    options:
      - id: a
        text: "Falta de personal en RecepciÃ³n"
      - id: b
        text: "Silo total entre AprobaciÃ³n y AtenciÃ³n al Cliente"
      - id: c
        text: "El Gerente no supervisa correctamente"
      - id: d
        text: "Los Inspectores trabajan de forma independiente"
    correct: b
    feedback_correct: "Â¡Correcto! AprobaciÃ³n y AtenciÃ³n tienen 0 conexiones. Esto causa que los casos se 'pierdan' despuÃ©s de aprobarse y los clientes no reciban actualizaciones."
    feedback_incorrect: "Mira la matriz de conexiones entre departamentos. Â¿DÃ³nde hay un valor de 0?"

  - id: cq-02-cuello-botella
    question: "Â¿QuiÃ©n es el principal cuello de botella en el flujo de trabajo?"
    options:
      - id: a
        text: "El Gerente"
      - id: b
        text: "Sup_Ana (Supervisor de AnÃ¡lisis)"
      - id: c
        text: "AC1 (AtenciÃ³n al Cliente)"
      - id: d
        text: "R1 (RecepciÃ³n)"
    correct: b
    feedback_correct: "Â¡Exacto! Sup_Ana tiene intermediaciÃ³n de 0.35 - el 100% de los casos pasan de RecepciÃ³n a AnÃ¡lisis a travÃ©s de Ã©l. Si estÃ¡ ocupado, todo se frena."
    feedback_incorrect: "Observa el grÃ¡fico de barras de 'Top Cuellos de Botella'. Â¿QuiÃ©n tiene la mayor intermediaciÃ³n?"

  - id: cq-03-intervencion-efectiva
    question: "Â¿CuÃ¡l intervenciÃ³n tendrÃ­a MAYOR impacto en reducir el tiempo de aprobaciÃ³n?"
    options:
      - id: a
        text: "Contratar mÃ¡s personal en AtenciÃ³n al Cliente"
      - id: b
        text: "Crear conexiÃ³n directa entre AprobaciÃ³n y AtenciÃ³n"
      - id: c
        text: "Capacitar al Gerente en gestiÃ³n de equipos"
      - id: d
        text: "Implementar un software de tracking de casos"
    correct: b
    feedback_correct: "Â¡Perfecto! Crear la conexiÃ³n AprobaciÃ³nâ†’AtenciÃ³n ataca la causa raÃ­z (el silo). Las otras opciones no resuelven que los casos se 'pierdan' entre departamentos."
    feedback_incorrect: "La soluciÃ³n debe atacar el SILO identificado. Â¿CuÃ¡l opciÃ³n crea conexiones donde actualmente hay 0?"
