# Ejercicio 7: DiagnÃ³stico de silos organizacionales
# Tipo: code-python (cÃ³digo oculto)

id: ex-07-diagnostico-silos
type: code-python
title: "DiagnÃ³stico de silos"
description: "Identifica y cuantifica silos entre departamentos usando mÃ©tricas de red."

instructions: |
  **Contexto:**
  Una empresa de retail con 4 departamentos (Compras, Ventas, LogÃ­stica, Marketing)
  sospecha que hay silos que afectan la coordinaciÃ³n.

  **Tu tarea:**
  Analiza la visualizaciÃ³n de la red y la tabla de conexiones inter-departamentales.

  **Preguntas a responder:**
  1. Â¿QuÃ© par de departamentos tiene MENOS conexiÃ³n?
  2. Â¿QuÃ© departamento estÃ¡ MÃS aislado del resto?
  3. Â¿QuÃ© impacto de negocio podrÃ­a tener este patrÃ³n?

difficulty: intermediate
estimated_time_minutes: 10
points: 30
order: 7

required_packages:
  - networkx
  - matplotlib
  - pandas
  - numpy

ui_config:
  hide_code: true
  show_output_only: true
  interactive_mode: visualization

datasets:
  - id: retail_multipais
    path: shared/datasets/retail_multipais.csv
    name: "Retail MultipaÃ­s"
    description: "Datos de ONA de empresa retail con 4 departamentos"

starter_code: |
  import networkx as nx
  import matplotlib.pyplot as plt
  import pandas as pd
  import numpy as np

  # Crear red con 4 departamentos
  G = nx.Graph()

  # Nodos por departamento
  departamentos = {
      'Compras': ['C1', 'C2', 'C3', 'C4'],
      'Ventas': ['V1', 'V2', 'V3', 'V4', 'V5'],
      'LogÃ­stica': ['L1', 'L2', 'L3'],
      'Marketing': ['M1', 'M2', 'M3']
  }

  # Agregar nodos con atributo de departamento
  for dept, nodos in departamentos.items():
      for nodo in nodos:
          G.add_node(nodo, departamento=dept)

  # Conexiones INTERNAS (dentro de cada departamento)
  edges_internas = [
      # Compras - bien conectado internamente
      ('C1', 'C2'), ('C2', 'C3'), ('C3', 'C4'), ('C1', 'C3'),
      # Ventas - muy conectado internamente
      ('V1', 'V2'), ('V2', 'V3'), ('V3', 'V4'), ('V4', 'V5'),
      ('V1', 'V3'), ('V2', 'V4'), ('V1', 'V5'),
      # LogÃ­stica - conectado internamente
      ('L1', 'L2'), ('L2', 'L3'), ('L1', 'L3'),
      # Marketing - conectado internamente
      ('M1', 'M2'), ('M2', 'M3'),
  ]

  # Conexiones ENTRE departamentos (pocas!)
  edges_entre = [
      # Compras - LogÃ­stica: BUENA conexiÃ³n
      ('C1', 'L1'), ('C2', 'L2'), ('C3', 'L1'),
      # Ventas - Marketing: BUENA conexiÃ³n
      ('V1', 'M1'), ('V2', 'M2'), ('V3', 'M1'),
      # Compras - Marketing: POCA conexiÃ³n (SILO!)
      ('C4', 'M3'),  # Solo 1 conexiÃ³n
      # Ventas - LogÃ­stica: POCA conexiÃ³n (SILO!)
      ('V5', 'L3'),  # Solo 1 conexiÃ³n
      # Compras - Ventas: conexiÃ³n media
      ('C1', 'V1'), ('C2', 'V2'),
      # LogÃ­stica - Marketing: NINGUNA conexiÃ³n (SILO TOTAL!)
  ]

  G.add_edges_from(edges_internas + edges_entre)

  # Calcular matriz de conexiones inter-departamentales
  dept_names = list(departamentos.keys())
  matriz_conexiones = pd.DataFrame(0, index=dept_names, columns=dept_names)

  for edge in G.edges():
      n1, n2 = edge
      d1 = G.nodes[n1]['departamento']
      d2 = G.nodes[n2]['departamento']
      if d1 != d2:
          matriz_conexiones.loc[d1, d2] += 1
          matriz_conexiones.loc[d2, d1] += 1

  # VisualizaciÃ³n
  fig, axes = plt.subplots(1, 2, figsize=(16, 7))

  # GrÃ¡fico de red
  colores_dept = {
      'Compras': '#3498db',
      'Ventas': '#2ecc71',
      'LogÃ­stica': '#e67e22',
      'Marketing': '#9b59b6'
  }
  node_colors = [colores_dept[G.nodes[n]['departamento']] for n in G.nodes()]

  pos = nx.spring_layout(G, k=2.5, seed=42)
  nx.draw(G, pos, ax=axes[0], with_labels=True,
          node_color=node_colors, node_size=1200, font_size=9,
          font_weight='bold', edge_color='gray', alpha=0.8)
  axes[0].set_title("Red Organizacional por Departamento", fontsize=12, fontweight='bold')

  # Leyenda
  legend_elements = [
      plt.Line2D([0], [0], marker='o', color='w', markerfacecolor=c, markersize=12, label=d)
      for d, c in colores_dept.items()
  ]
  axes[0].legend(handles=legend_elements, loc='upper left')

  # Heatmap de conexiones
  im = axes[1].imshow(matriz_conexiones.values, cmap='YlOrRd')
  axes[1].set_xticks(range(len(dept_names)))
  axes[1].set_yticks(range(len(dept_names)))
  axes[1].set_xticklabels(dept_names, rotation=45, ha='right')
  axes[1].set_yticklabels(dept_names)

  # Agregar valores en cada celda
  for i in range(len(dept_names)):
      for j in range(len(dept_names)):
          val = matriz_conexiones.iloc[i, j]
          color = 'white' if val > 2 else 'black'
          axes[1].text(j, i, str(val), ha='center', va='center', color=color, fontsize=12)

  axes[1].set_title("Conexiones Entre Departamentos\n(0 = SILO)", fontsize=12, fontweight='bold')
  plt.colorbar(im, ax=axes[1], label='NÃºmero de conexiones')

  plt.tight_layout()
  plt.show()

  # Resumen de diagnÃ³stico
  print("\n" + "="*60)
  print("DIAGNÃ“STICO DE SILOS")
  print("="*60)

  print("\nðŸ“Š MATRIZ DE CONEXIONES INTER-DEPARTAMENTALES:")
  print(matriz_conexiones.to_string())

  print("\nðŸš¨ ALERTAS:")
  for i, d1 in enumerate(dept_names):
      for j, d2 in enumerate(dept_names):
          if i < j:
              val = matriz_conexiones.loc[d1, d2]
              if val == 0:
                  print(f"   â›” {d1} â†” {d2}: SIN CONEXIONES (silo total)")
              elif val == 1:
                  print(f"   âš ï¸  {d1} â†” {d2}: Solo 1 conexiÃ³n (riesgo de silo)")

  print("\n" + "="*60)
  print("PREGUNTAS DE ANÃLISIS")
  print("="*60)
  print("\n1. Â¿QuÃ© par de departamentos tiene la conexiÃ³n mÃ¡s dÃ©bil?")
  print("   A) Compras - Ventas")
  print("   B) LogÃ­stica - Marketing")
  print("   C) Ventas - LogÃ­stica")
  print("   D) Compras - Marketing")

solution_code: |
  # Respuesta correcta: B) LogÃ­stica - Marketing
  #
  # Este par tiene 0 conexiones (silo total).
  #
  # Impacto de negocio:
  # - Marketing lanza promociones sin coordinar con LogÃ­stica
  # - LogÃ­stica no puede prepararse para picos de demanda
  # - Resultado: stockouts, entregas tardÃ­as, clientes insatisfechos
  #
  # RecomendaciÃ³n:
  # - Crear reuniones semanales Marketing-LogÃ­stica
  # - Asignar enlace formal entre departamentos
  # - Incluir LogÃ­stica en planificaciÃ³n de campaÃ±as

test_cases:
  - id: test-silo-analysis
    name: "AnÃ¡lisis de silos completado"
    test_code: |
      assert True, "AnÃ¡lisis ejecutado correctamente"
    points: 30

hints:
  - "Busca el par de departamentos con valor 0 en la matriz"
  - "Los colores mÃ¡s claros en el heatmap indican menos conexiones"
  - "Un silo total significa que dos departamentos no se comunican directamente"

tags:
  - ona
  - silos
  - heatmap
  - diagnostico

concepts:
  - silos-organizacionales
  - conexiones-inter-departamentales
  - diagnostico-red

# Preguntas interactivas mostradas despuÃ©s de la visualizaciÃ³n
comprehension_questions:
  - id: cq-01-silo-total
    question: "Â¿QuÃ© par de departamentos tiene la conexiÃ³n mÃ¡s dÃ©bil (silo total)?"
    options:
      - id: a
        text: "Compras - Ventas"
      - id: b
        text: "LogÃ­stica - Marketing"
      - id: c
        text: "Ventas - LogÃ­stica"
      - id: d
        text: "Compras - Marketing"
    correct: b
    feedback_correct: "Â¡Correcto! LogÃ­stica y Marketing tienen 0 conexiones entre sÃ­. Esto es un 'silo total' - no hay comunicaciÃ³n directa."
    feedback_incorrect: "Busca en el heatmap (mapa de calor) el par con valor 0. Ese indica un silo total."

  - id: cq-02-impacto-negocio
    question: "Â¿QuÃ© impacto de negocio podrÃ­a tener este silo entre LogÃ­stica y Marketing?"
    options:
      - id: a
        text: "Ninguno - son departamentos independientes"
      - id: b
        text: "Marketing lanza promociones sin que LogÃ­stica pueda preparar el inventario"
      - id: c
        text: "Los empleados no se conocen personalmente"
      - id: d
        text: "El Gerente General no tiene visibilidad de ambas Ã¡reas"
    correct: b
    feedback_correct: "Â¡Exacto! Sin coordinaciÃ³n, Marketing puede lanzar campaÃ±as que generan demanda que LogÃ­stica no puede cumplir. Resultado: stockouts, entregas tardÃ­as, clientes insatisfechos."
    feedback_incorrect: "Piensa en el flujo de trabajo: Marketing genera demanda â†’ LogÃ­stica debe cumplirla. Â¿QuÃ© pasa si no se comunican?"

  - id: cq-03-recomendacion
    question: "Â¿CuÃ¡l serÃ­a la recomendaciÃ³n mÃ¡s efectiva para resolver este silo?"
    options:
      - id: a
        text: "Fusionar ambos departamentos bajo un solo gerente"
      - id: b
        text: "Implementar reuniones obligatorias entre todos los empleados"
      - id: c
        text: "Crear un rol de enlace formal y reuniones de planificaciÃ³n conjunta"
      - id: d
        text: "Instalar un software de comunicaciÃ³n interna"
    correct: c
    feedback_correct: "Â¡Correcto! Un enlace formal + reuniones estructuradas crea conexiones sostenibles sin reorganizaciÃ³n costosa. El software solo ayuda si hay voluntad de comunicarse."
    feedback_incorrect: "La soluciÃ³n debe crear conexiones formales sostenibles entre los departamentos, sin cambios estructurales drÃ¡sticos."
