# Ejercicio 4: Caso Banco Regional - Interpretar m√©tricas
# Tipo: code-python (c√≥digo oculto)

id: ex-04-caso-banco
type: code-python
title: "Caso Banco Regional"
description: "Interpreta las m√©tricas de ONA para diagnosticar tiempos de aprobaci√≥n."

instructions: |
  El **Banco Regional del Sur** tiene tiempos de aprobaci√≥n de cr√©dito muy diferentes
  entre sucursales. Analiza las m√©tricas de ONA de dos sucursales y explica la diferencia.

  **Contexto del caso**:
  - Sucursal A: Tiempo promedio de aprobaci√≥n = 2 d√≠as
  - Sucursal B: Tiempo promedio de aprobaci√≥n = 8 d√≠as
  - Ambas tienen el mismo n√∫mero de empleados y volumen de casos

  **Tu tarea**: Usa las m√©tricas para explicar por qu√© Sucursal B es m√°s lenta.

difficulty: intermediate
estimated_time_minutes: 10
points: 30
order: 4

ui_config:
  hide_code: true
  show_output_only: true
  interactive_mode: visualization

datasets:
  - id: banco_regional
    path: shared/datasets/banco_regional.csv
    name: "Banco Regional"
    description: "Datos de ONA de dos sucursales"

starter_code: |
  import networkx as nx
  import matplotlib.pyplot as plt
  import pandas as pd

  # Sucursal A: Estructura eficiente (directa)
  G_A = nx.Graph()
  nodes_A = ["Gerente", "Analista 1", "Analista 2", "Analista 3", "Ejecutivo 1", "Ejecutivo 2"]
  edges_A = [
      ("Gerente", "Analista 1"), ("Gerente", "Analista 2"), ("Gerente", "Analista 3"),
      ("Analista 1", "Ejecutivo 1"), ("Analista 2", "Ejecutivo 2"),
      ("Ejecutivo 1", "Gerente"), ("Ejecutivo 2", "Gerente"),  # Acceso directo
  ]
  G_A.add_nodes_from(nodes_A)
  G_A.add_edges_from(edges_A)

  # Sucursal B: Estructura con cuello de botella
  G_B = nx.Graph()
  nodes_B = ["Gerente", "Experto", "Analista 1", "Analista 2", "Analista 3", "Ejecutivo 1", "Ejecutivo 2"]
  edges_B = [
      ("Gerente", "Experto"),  # Solo el experto habla con el gerente
      ("Experto", "Analista 1"), ("Experto", "Analista 2"), ("Experto", "Analista 3"),
      ("Analista 1", "Ejecutivo 1"), ("Analista 2", "Ejecutivo 2"),
      ("Ejecutivo 1", "Experto"), ("Ejecutivo 2", "Experto"),  # Todo pasa por el experto
  ]
  G_B.add_nodes_from(nodes_B)
  G_B.add_edges_from(edges_B)

  # M√©tricas
  def get_metrics(G):
      return {
          'degree': nx.degree_centrality(G),
          'betweenness': nx.betweenness_centrality(G),
          'closeness': nx.closeness_centrality(G)
      }

  metrics_A = get_metrics(G_A)
  metrics_B = get_metrics(G_B)

  # Visualizaci√≥n comparativa
  fig, axes = plt.subplots(1, 2, figsize=(14, 6))

  # Sucursal A
  pos_A = nx.spring_layout(G_A, k=2, seed=42)
  colors_A = [metrics_A['betweenness'][n]*2000 for n in G_A.nodes()]
  nx.draw(G_A, pos_A, ax=axes[0], with_labels=True,
          node_color=colors_A, cmap=plt.cm.Reds,
          node_size=1500, font_size=9, font_weight='bold')
  axes[0].set_title("Sucursal A (R√°pida)\nTiempo: 2 d√≠as", fontsize=12, fontweight='bold')

  # Sucursal B
  pos_B = nx.spring_layout(G_B, k=2, seed=42)
  colors_B = [metrics_B['betweenness'][n]*2000 for n in G_B.nodes()]
  nx.draw(G_B, pos_B, ax=axes[1], with_labels=True,
          node_color=colors_B, cmap=plt.cm.Reds,
          node_size=1500, font_size=9, font_weight='bold')
  axes[1].set_title("Sucursal B (Lenta)\nTiempo: 8 d√≠as", fontsize=12, fontweight='bold')

  plt.suptitle("Color m√°s oscuro = Mayor intermediaci√≥n (cuello de botella)", fontsize=10)
  plt.tight_layout()
  plt.show()

  # Tabla comparativa de m√©tricas clave
  print("\n" + "="*60)
  print("M√âTRICAS COMPARATIVAS")
  print("="*60)

  print("\nüìä SUCURSAL A (R√°pida):")
  print(f"   Cercan√≠a del Gerente: {metrics_A['closeness']['Gerente']:.2f}")
  print(f"   M√°xima intermediaci√≥n: {max(metrics_A['betweenness'].values()):.2f}")

  print("\nüìä SUCURSAL B (Lenta):")
  print(f"   Cercan√≠a del Gerente: {metrics_B['closeness']['Gerente']:.2f}")
  print(f"   M√°xima intermediaci√≥n: {max(metrics_B['betweenness'].values()):.2f}")
  print(f"   Nodo con mayor intermediaci√≥n: {max(metrics_B['betweenness'], key=metrics_B['betweenness'].get)}")

  print("\n" + "="*60)
  print("PREGUNTA DE AN√ÅLISIS")
  print("="*60)
  print("\n¬øPor qu√© la Sucursal B es m√°s lenta?")
  print("\nOpciones:")
  print("A) Tiene m√°s empleados")
  print("B) El Experto es cuello de botella - todo pasa por √©l")
  print("C) El Gerente no tiene suficientes conexiones")
  print("D) Los Ejecutivos est√°n desconectados")

solution_code: |
  # Respuesta correcta: B) El Experto es cuello de botella
  #
  # En Sucursal B:
  # - El "Experto" tiene intermediaci√≥n muy alta (0.7+)
  # - El Gerente tiene cercan√≠a baja (no puede comunicarse directamente)
  # - Toda informaci√≥n pasa por el Experto, creando demoras
  #
  # En Sucursal A:
  # - El Gerente tiene acceso directo a Analistas y Ejecutivos
  # - La intermediaci√≥n est√° distribuida
  # - Los flujos son m√°s cortos

test_cases:
  - id: test-case-analysis
    name: "An√°lisis del caso"
    test_code: |
      assert True, "Caso analizado correctamente"
    points: 30

hints:
  - "Observa qu√© nodo tiene el color m√°s oscuro en cada red"
  - "Compara la cercan√≠a del Gerente en ambas sucursales"
  - "El cuello de botella es donde se acumula la intermediaci√≥n"

tags:
  - ona
  - caso-practico
  - banco
  - cuello-de-botella

concepts:
  - cuello-de-botella
  - intermediacion
  - eficiencia-red
