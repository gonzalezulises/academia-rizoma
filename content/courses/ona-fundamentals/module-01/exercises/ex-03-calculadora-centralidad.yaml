# Ejercicio 3: Calculadora interactiva de centralidad
# Tipo: code-python (c√≥digo oculto)

id: ex-03-calculadora-centralidad
type: code-python
title: "Calculadora de centralidad"
description: "Explora c√≥mo cambian las m√©tricas al modificar conexiones en una red."

instructions: |
  Esta calculadora interactiva te permite ver c√≥mo las m√©tricas de centralidad
  cambian seg√∫n la posici√≥n de una persona en la red.

  **Observa la tabla de m√©tricas** y responde:

  1. ¬øQui√©n tiene el mayor GRADO (degree)?
  2. ¬øQui√©n tiene la mayor INTERMEDIACI√ìN (betweenness)?
  3. ¬øQui√©n tiene la mayor CERCAN√çA (closeness)?
  4. ¬øSon la misma persona? ¬øPor qu√© s√≠ o por qu√© no?

difficulty: intermediate
estimated_time_minutes: 8
points: 30
order: 3

required_packages:
  - networkx
  - matplotlib
  - pandas

ui_config:
  hide_code: true
  show_output_only: true
  interactive_mode: visualization

starter_code: |
  import networkx as nx
  import matplotlib.pyplot as plt
  import pandas as pd

  # Red de ejemplo con diferentes patrones de centralidad
  G = nx.Graph()

  # Nodos y sus roles
  nodes = ["Ana", "Bruno", "Carlos", "Diana", "Elena", "Felipe", "Gloria"]

  # Conexiones que crean diferentes patrones de centralidad
  edges = [
      # Ana es hub central (alto grado)
      ("Ana", "Bruno"), ("Ana", "Carlos"), ("Ana", "Diana"),
      ("Ana", "Elena"), ("Ana", "Felipe"),
      # Gloria es broker (alta intermediaci√≥n)
      ("Gloria", "Ana"), ("Gloria", "Felipe"),
      # Carlos tiene cluster propio
      ("Carlos", "Diana"), ("Diana", "Elena"),
      # Felipe est√° en la periferia
      ("Felipe", "Gloria"),
  ]

  G.add_nodes_from(nodes)
  G.add_edges_from(edges)

  # Calcular m√©tricas
  degree = dict(G.degree())
  betweenness = nx.betweenness_centrality(G)
  closeness = nx.closeness_centrality(G)

  # Crear DataFrame para visualizaci√≥n
  df = pd.DataFrame({
      'Persona': nodes,
      'Grado': [degree[n] for n in nodes],
      'Intermediaci√≥n': [round(betweenness[n], 2) for n in nodes],
      'Cercan√≠a': [round(closeness[n], 2) for n in nodes]
  })
  df = df.sort_values('Grado', ascending=False)

  # Visualizaci√≥n
  fig, axes = plt.subplots(1, 2, figsize=(14, 6))

  # Gr√°fico de red
  pos = nx.spring_layout(G, k=2, seed=42)

  # Colorear por grado
  node_colors = [degree[n] for n in G.nodes()]

  nx.draw(G, pos, ax=axes[0], with_labels=True,
          node_color=node_colors, cmap=plt.cm.YlOrRd,
          node_size=2000, font_size=10, font_weight='bold',
          edge_color='gray')
  axes[0].set_title("Red de Ejemplo\n(Color = Grado)", fontsize=12, fontweight='bold')

  # Tabla de m√©tricas
  axes[1].axis('off')
  table = axes[1].table(
      cellText=df.values,
      colLabels=df.columns,
      cellLoc='center',
      loc='center',
      colColours=['#f0f0f0']*4
  )
  table.auto_set_font_size(False)
  table.set_fontsize(11)
  table.scale(1.2, 1.8)
  axes[1].set_title("M√©tricas de Centralidad", fontsize=12, fontweight='bold', pad=20)

  plt.tight_layout()
  plt.show()

  # Preguntas de an√°lisis
  print("\n" + "="*60)
  print("AN√ÅLISIS DE M√âTRICAS")
  print("="*60)
  print("\nüìä Observa la tabla y responde:")
  print("\n1. ¬øQui√©n tiene el MAYOR grado?")
  print("   ‚Üí Indica qui√©n recibe m√°s consultas directas")
  print("\n2. ¬øQui√©n tiene la MAYOR intermediaci√≥n?")
  print("   ‚Üí Indica qui√©n conecta grupos")
  print("\n3. ¬øQui√©n tiene la MAYOR cercan√≠a?")
  print("   ‚Üí Indica qui√©n llega m√°s r√°pido a todos")
  print("\n4. ¬øPor qu√© Ana tiene el grado m√°s alto pero Gloria")
  print("   tiene la intermediaci√≥n m√°s alta?")

solution_code: |
  # Respuestas:
  # 1. Ana tiene el mayor grado (5 conexiones)
  # 2. Gloria tiene la mayor intermediaci√≥n (conecta Ana con Felipe)
  # 3. Ana tiene la mayor cercan√≠a (est√° en el centro)
  # 4. Ana tiene muchas conexiones directas, pero Gloria est√° en la
  #    √∫nica ruta entre ciertos nodos (es puente obligatorio)

test_cases:
  - id: test-metrics-display
    name: "M√©tricas calculadas"
    test_code: |
      assert True, "M√©tricas mostradas correctamente"
    points: 15

  - id: test-analysis
    name: "An√°lisis completado"
    test_code: |
      assert True, "An√°lisis registrado"
    points: 15

hints:
  - "El grado es simplemente el n√∫mero de conexiones"
  - "La intermediaci√≥n mide cu√°ntos 'caminos' pasan por la persona"
  - "La cercan√≠a mide qu√© tan 'cerca' est√° de todos los dem√°s"

tags:
  - ona
  - metricas
  - degree
  - betweenness
  - closeness

concepts:
  - degree-centrality
  - betweenness-centrality
  - closeness-centrality

# Preguntas interactivas mostradas despu√©s de la visualizaci√≥n
comprehension_questions:
  - id: cq-01-mayor-grado
    question: "¬øQui√©n tiene el MAYOR grado (degree) en la red?"
    options:
      - id: a
        text: "Gloria"
      - id: b
        text: "Ana"
      - id: c
        text: "Carlos"
      - id: d
        text: "Felipe"
    correct: b
    feedback_correct: "¬°Correcto! Ana tiene 5 conexiones directas, el n√∫mero m√°s alto de la red. Esto la hace la persona m√°s 'popular' o consultada."
    feedback_incorrect: "El grado es simplemente el n√∫mero de conexiones. Mira la columna 'Grado' en la tabla de m√©tricas."

  - id: cq-02-mayor-intermediacion
    question: "¬øQui√©n tiene la MAYOR intermediaci√≥n (betweenness)?"
    options:
      - id: a
        text: "Ana"
      - id: b
        text: "Gloria"
      - id: c
        text: "Bruno"
      - id: d
        text: "Diana"
    correct: b
    feedback_correct: "¬°Exacto! Gloria es el 'puente' obligatorio entre ciertos nodos. Aunque tiene menos conexiones que Ana, muchos caminos pasan por ella."
    feedback_incorrect: "La intermediaci√≥n mide cu√°ntos caminos 'pasan' por una persona. Mira la columna 'Intermediaci√≥n' en la tabla."

  - id: cq-03-diferencia
    question: "¬øPor qu√© Ana tiene el grado m√°s alto pero Gloria tiene la intermediaci√≥n m√°s alta?"
    options:
      - id: a
        text: "Ana est√° desconectada de algunos nodos"
      - id: b
        text: "Gloria tiene m√°s conexiones directas"
      - id: c
        text: "Gloria est√° en la √∫nica ruta entre ciertos nodos (es puente obligatorio)"
      - id: d
        text: "Ana rechaza consultas de algunos colegas"
    correct: c
    feedback_correct: "¬°Perfecto! Esta distinci√≥n es clave: tener muchas conexiones (grado) no es lo mismo que estar en el 'camino' entre otros (intermediaci√≥n). Un broker puede tener pocas conexiones pero ser cr√≠tico."
    feedback_incorrect: "Piensa en la diferencia entre 'cu√°ntos te conocen' vs 'cu√°ntos dependen de ti para llegar a otros'."
